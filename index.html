
        <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NIT Attendance Management System</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
    
    :root{ 
      --bg-primary: #001a33;
      --bg-secondary: #002b4d;
      --bg-tertiary: #003d66;
      --accent-1: #0ea5e9;
      --accent-2: #06b6d4;
      --accent-3: #3b82f6;
      --accent-4: #60a5fa;
      --success: #10b981;
      --success-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --info: #06b6d4;
      --card: #002b4d;
      --card-light: #003d66;
      --border: #005580;
      --text: #e0f2fe;
      --text-secondary: #bae6fd;
      --text-muted: #7dd3fc;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #001a33 0%, #002b4d 50%, #004d7a 100%);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(14, 165, 233, 0.15) 0%, transparent 70%);
      animation: rotate 30s linear infinite;
      pointer-events: none;
      z-index: 0;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    
    header {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.25) 0%, rgba(6, 182, 212, 0.25) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(14, 165, 233, 0.4);
      padding: 40px;
      border-radius: 24px;
      margin-bottom: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 0 0 40px rgba(14, 165, 233, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #0ea5e9, #06b6d4, #3b82f6, #60a5fa);
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }
    
    .college-logo {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 16px;
    }
    
    .logo-icon {
      font-size: 64px;
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    header h1 {
      font-size: 42px;
      font-weight: 900;
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 50%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: -1px;
    }
    
    header .subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    header .tagline {
      font-size: 14px;
      color: var(--text-muted);
      font-weight: 400;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(0, 43, 77, 0.9) 0%, rgba(0, 61, 102, 0.9) 100%);
      backdrop-filter: blur(20px);
      padding: 28px;
      border-radius: 20px;
      text-align: center;
      border: 1px solid rgba(14, 165, 233, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(14, 165, 233, 0.15), transparent);
      transition: left 0.5s;
    }
    
    .stat-card:hover::before {
      left: 100%;
    }
    
    .stat-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 16px 48px rgba(14, 165, 233, 0.4);
      border-color: rgba(14, 165, 233, 0.6);
    }
    
    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
      opacity: 0.8;
    }
    
    .stat-value {
      font-size: 48px;
      font-weight: 900;
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    
    .stat-card.success .stat-value {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-card.danger .stat-value {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-card.warning .stat-value {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .card {
      background: linear-gradient(135deg, rgba(0, 43, 77, 0.95) 0%, rgba(0, 61, 102, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 32px;
      border: 1px solid rgba(14, 165, 233, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      border-color: rgba(14, 165, 233, 0.5);
      box-shadow: 0 12px 48px rgba(14, 165, 233, 0.3);
    }
    
    .card h2 {
      font-size: 24px;
      margin-bottom: 24px;
      color: var(--text);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 16px;
      border-bottom: 2px solid rgba(14, 165, 233, 0.4);
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      font-size: 13px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .input-group input,
    .input-group select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      transition: all 0.3s ease;
      background: rgba(15, 23, 42, 0.5);
      color: var(--text);
      font-weight: 500;
      font-family: 'Poppins', sans-serif;
    }
    
    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--accent-1);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
      background: rgba(15, 23, 42, 0.8);
    }
    
    .input-group select option {
      background: var(--bg-secondary);
      color: var(--text);
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
    }
    
    .btn:active {
      transform: translateY(-1px);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(14, 165, 233, 0.5);
    }
    
    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(239, 68, 68, 0.4);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #64748b 0%, #475569 100%);
      color: white;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--accent-1);
      color: var(--accent-1);
    }
    
    .btn-outline:hover {
      background: var(--accent-1);
      color: white;
    }
    
    .btn-small {
      padding: 10px 18px;
      font-size: 12px;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .item-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .item-card:hover {
      border-color: var(--accent-1);
      transform: translateX(6px);
      background: rgba(15, 23, 42, 0.8);
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.2);
    }
    
    .item-info {
      flex: 1;
    }
    
    .item-name {
      font-weight: 700;
      color: var(--text);
      font-size: 16px;
      margin-bottom: 4px;
    }
    
    .item-detail {
      font-size: 13px;
      color: var(--text-muted);
      font-weight: 500;
    }
    
    .btn-group {
      display: flex;
      gap: 8px;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 14px;
    }
    
    thead {
      background: rgba(15, 23, 42, 0.8);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    th {
      padding: 18px 16px;
      text-align: left;
      font-weight: 700;
      color: var(--text);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 12px;
      border-bottom: 2px solid var(--accent-1);
    }
    
    td {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    tbody tr {
      transition: all 0.2s ease;
      background: rgba(30, 41, 59, 0.3);
    }
    
    tbody tr:hover {
      background: rgba(59, 130, 246, 0.1);
      transform: scale(1.01);
    }
    
    .badge {
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .status-present {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    .status-absent {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }
    
    .section-badge {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }
    
    .class-badge {
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3);
    }
    
    .subject-badge {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    .view-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 2px solid var(--border);
      overflow-x: auto;
    }
    
    .tab {
      padding: 14px 24px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-weight: 700;
      color: var(--text-muted);
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 13px;
      font-family: 'Poppins', sans-serif;
    }
    
    .tab:hover {
      color: var(--accent-1);
      background: rgba(59, 130, 246, 0.1);
    }
    
    .tab.active {
      color: var(--accent-1);
      border-bottom-color: var(--accent-1);
      background: rgba(59, 130, 246, 0.1);
    }
    
    .selector-chips {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      padding: 20px;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 12px;
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    
    .chip {
      padding: 12px 24px;
      background: rgba(30, 41, 59, 0.8);
      border: 2px solid var(--border);
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }
    
    .chip:hover {
      border-color: var(--accent-1);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .chip.active {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      color: white;
      border-color: transparent;
      box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
    }
    
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--text-muted);
    }
    
    .empty-state-icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    .quick-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 2px solid rgba(59, 130, 246, 0.3);
    }
    
    .search-box {
      position: relative;
      margin-bottom: 20px;
    }
    
    .search-box input {
      padding-left: 48px;
    }
    
    .search-box::before {
      content: "üîç";
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
    }
    
    .scroll-container {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 8px;
    }
    
    .scroll-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .scroll-container::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 10px;
    }
    
    .scroll-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      border-radius: 10px;
    }
    
    .scroll-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
    }
    
    /* Responsive Design */
    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: 1fr;
      }
      
      .stats {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 968px) {
      body {
        padding: 12px;
      }
      
      header {
        padding: 28px 24px;
      }
      
      header h1 {
        font-size: 32px;
      }
      
      .logo-icon {
        font-size: 48px;
      }
      
      .stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .stat-card {
        padding: 20px;
      }
      
      .stat-value {
        font-size: 38px;
      }
      
      .card {
        padding: 24px;
      }
      
      .card h2 {
        font-size: 20px;
      }
      
      table {
        font-size: 13px;
      }
      
      th, td {
        padding: 12px 10px;
      }
    }
    
    @media (max-width: 640px) {
      body {
        padding: 8px;
      }
      
      header {
        padding: 24px 20px;
        border-radius: 20px;
      }
      
      header h1 {
        font-size: 24px;
      }
      
      .college-logo {
        flex-direction: column;
        text-align: center;
        gap: 12px;
      }
      
      .logo-icon {
        font-size: 56px;
      }
      
      .stats {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .stat-card {
        padding: 20px;
      }
      
      .stat-value {
        font-size: 42px;
      }
      
      .card {
        padding: 20px;
        border-radius: 20px;
      }
      
      .item-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .btn-group {
        width: 100%;
        justify-content: flex-end;
      }
      
      table {
        display: block;
        overflow-x: auto;
      }
      
      thead {
        display: none;
      }
      
      tbody, tr {
        display: block;
      }
      
      tr {
        margin-bottom: 16px;
        padding: 16px;
        background: rgba(15, 23, 42, 0.8);
        border-radius: 12px;
        border: 1px solid var(--border);
      }
      
      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border: none;
      }
      
      td::before {
        content: attr(data-label);
        font-weight: 700;
        text-transform: uppercase;
        font-size: 11px;
        color: var(--text-muted);
        letter-spacing: 0.5px;
      }
      
      .quick-actions {
        flex-direction: column;
      }
      
      .quick-actions .btn {
        width: 100%;
      }
      
      .chip {
        padding: 10px 20px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="college-logo">
        <div class="logo-icon">üéì</div>
        <div>
          <h1>Nagpur Institute of Technology</h1>
          <div class="subtitle">Smart Attendance Management System</div>
          <div class="tagline">Empowering Education Through Innovation</div>
        </div>
      </div>
    </header>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-value" id="totalStudents">0</div>
        <div class="stat-label">Total Students</div>
      </div>
      <div class="stat-card success">
        <div class="stat-icon">‚úì</div>
        <div class="stat-value" id="presentToday">0</div>
        <div class="stat-label">Present Today</div>
      </div>
      <div class="stat-card danger">
        <div class="stat-icon">‚úó</div>
        <div class="stat-value" id="absentToday">0</div>
        <div class="stat-label">Absent Today</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-value" id="attendanceRate">0%</div>
        <div class="stat-label">Attendance Rate</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-icon">üè´</div>
        <div class="stat-value" id="totalClasses">0</div>
        <div class="stat-label">Total Classes</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìö</div>
        <div class="stat-value" id="totalSubjects">0</div>
        <div class="stat-label">Total Subjects</div>
      </div>
    </div>

    <div class="grid">
      <!-- Left Panel -->
      <div>
        <!-- Class Management -->
        <div class="card">
          <h2>üè´ Class Management</h2>
          
          <div class="input-group">
            <label>Class Name</label>
            <input type="text" id="className" placeholder="e.g., BE Computer">
          </div>
          
          <div class="input-group">
            <label>Year/Semester</label>
            <select id="classYear">
              <option value="">Select Year</option>
              <option value="FE">First Year (FE)</option>
              <option value="SE">Second Year (SE)</option>
              <option value="TE">Third Year (TE)</option>
              <option value="BE">Final Year (BE)</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Section</label>
            <input type="text" id="classSection" placeholder="e.g., A, B, C">
          </div>
          
          <button class="btn btn-warning" id="addClassBtn" style="width:100%">
            ‚ûï Add Class
          </button>
          
          <div id="classList" class="scroll-container" style="margin-top:20px;max-height:250px"></div>
        </div>

        <!-- Subject Management -->
        <div class="card" style="margin-top:20px">
          <h2>üìö Subject Management</h2>
          
          <div class="input-group">
            <label>Select Class</label>
            <select id="subjectClass">
              <option value="">Select Class</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Subject Name</label>
            <input type="text" id="subjectName" placeholder="e.g., Data Structures">
          </div>
          
          <div class="input-group">
            <label>Subject Code</label>
            <input type="text" id="subjectCode" placeholder="e.g., CS301">
          </div>
          
          <button class="btn btn-primary" id="addSubjectBtn" style="width:100%">
            ‚ûï Add Subject
          </button>
          
          <div id="subjectList" class="scroll-container" style="margin-top:20px;max-height:250px"></div>
        </div>

        <!-- Student Management -->
        <div class="card" style="margin-top:20px">
          <h2>üë®‚Äçüéì Student Management</h2>
          
          <div class="input-group">
            <label>Student Name</label>
            <input type="text" id="studentName" placeholder="Enter student name">
          </div>
          
          <div class="input-group">
            <label>Roll Number</label>
            <input type="text" id="studentRoll" placeholder="e.g., NIT2024001">
          </div>
          
          <div class="input-group">
            <label>Select Class</label>
            <select id="studentClass">
              <option value="">Select Class</option>
            </select>
          </div>
          
          <button class="btn btn-success" id="addStudentBtn" style="width:100%">
            ‚ûï Add Student
          </button>
          
          <div class="quick-actions">
            <button class="btn btn-outline btn-small" id="loadSampleBtn">üìù Load Sample Data</button>
            <button class="btn btn-secondary btn-small" id="clearAllBtn">üóëÔ∏è Clear All</button>
          </div>
        </div>

        <!-- Student List -->
        <div class="card" style="margin-top:20px">
          <h2>üìã Student Directory</h2>
          <div class="search-box">
            <input type="text" id="searchStudent" placeholder="Search students...">
          </div>
          <div id="studentList" class="scroll-container" style="max-height:350px"></div>
        </div>
      </div>

      <!-- Right Panel -->
      <div>
        <div class="card">
          <h2>üìÖ Attendance Tracking</h2>
          
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
            <div class="input-group">
              <label>Select Date</label>
              <input type="date" id="dateSelect">
            </div>
            <div class="input-group">
              <label>Quick Actions</label>
              <select id="quickAction">
                <option value="">Select action...</option>
                <option value="all-present">‚úì Mark All Present</option>
                <option value="all-absent">‚úó Mark All Absent</option>
              </select>
            </div>
          </div>

          <!-- Class Filter -->
          <div style="margin-bottom:20px">
            <label style="display:block;margin-bottom:10px;font-weight:600;font-size:13px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px">Filter by Class</label>
            <div class="selector-chips" id="classSelector"></div>
          </div>

          <!-- Subject Filter -->
          <div style="margin-bottom:20px">
            <label style="display:block;margin-bottom:10px;font-weight:600;font-size:13px;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px">Filter by Subject</label>
            <div class="selector-chips" id="subjectSelector"></div>
          </div>

          <div class="view-tabs">
            <button class="tab active" data-view="today">Today's Attendance</button>
            <button class="tab" data-view="class-wise">Class-Wise View</button>
            <button class="tab" data-view="subject-wise">Subject-Wise View</button>
            <button class="tab" data-view="history">History</button>
            <button class="tab" data-view="reports">Reports</button>
          </div>

          <div id="todayView">
            <div class="scroll-container">
              <table>
                <thead>
                  <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Class</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="attendanceTable"></tbody>
              </table>
            </div>
          </div>

          <div id="classWiseView" style="display:none">
            <div id="classWiseContent"></div>
          </div>

          <div id="subjectWiseView" style="display:none">
            <div id="subjectWiseContent"></div>
          </div>

          <div id="historyView" style="display:none">
            <div id="historyList" class="scroll-container"></div>
          </div>

          <div id="reportsView" style="display:none">
            <div id="reportContent"></div>
          </div>

          <div class="quick-actions">
            <button class="btn btn-success" id="exportCsvBtn">üì• Export Today's CSV</button>
            <button class="btn btn-warning" id="exportClassCsvBtn">üè´ Export Class CSV</button>
            <button class="btn btn-primary" id="exportSubjectCsvBtn">üìä Export Subject CSV</button>
            <button class="btn btn-outline" id="exportAllBtn">üìÅ Export All Records</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'nit_attendance_system_v1';
    let state = {
      classes: [],
      subjects: [],
      students: [],
      attendance: {},
      selectedClass: null,
      selectedSubject: null,
      savedAt: null
    };

    function init() {
      loadState();
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('dateSelect').value = today;
      render();
      attachEventListeners();
    }

    function loadState() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          state = JSON.parse(saved);
        } catch (e) {
          console.error('Failed to load state:', e);
        }
      }
    }

    function saveState() {
      state.savedAt = new Date().toISOString();
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function render() {
      renderStats();
      renderClassList();
      renderClassDropdowns();
      renderSubjectList();
      renderStudentList();
      renderClassSelector();
      renderSubjectSelector();
      renderAttendanceTable();
      renderClassWiseView();
      renderSubjectWiseView();
      renderHistory();
      renderReports();
    }

    function renderStats() {
      const date = document.getElementById('dateSelect').value;
      const selectedClass = state.selectedClass;
      const selectedSubject = state.selectedSubject;
      
      let filteredStudents = state.students;
      if (selectedClass) {
        filteredStudents = filteredStudents.filter(s => s.classId === selectedClass);
      }
      
      const total = filteredStudents.length;
      let present = 0;
      
      filteredStudents.forEach(s => {
        if (selectedSubject && getAttendance(date, s.id, selectedSubject) === 'present') {
          present++;
        } else if (!selectedSubject && getOverallAttendance(date, s.id) === 'present') {
          present++;
        }
      });
      
      const absent = total - present;
      const rate = total > 0 ? Math.round((present / total) * 100) : 0;
      
      document.getElementById('totalStudents').textContent = total;
      document.getElementById('presentToday').textContent = present;
      document.getElementById('absentToday').textContent = absent;
      document.getElementById('attendanceRate').textContent = rate + '%';
      document.getElementById('totalClasses').textContent = state.classes.length;
      document.getElementById('totalSubjects').textContent = state.subjects.length;
    }

    function renderClassList() {
      const container = document.getElementById('classList');
      
      if (state.classes.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding:30px">
            <div class="empty-state-icon">üè´</div>
            <p style="font-size:14px">No classes added yet</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = state.classes.map(cls => {
        const studentCount = state.students.filter(s => s.classId === cls.id).length;
        const subjectCount = state.subjects.filter(s => s.classId === cls.id).length;
        return `
          <div class="item-card">
            <div class="item-info">
              <div class="item-name">${escapeHtml(cls.name)}</div>
              <div class="item-detail">
                <span class="badge class-badge">${escapeHtml(cls.year)}</span>
                <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>
                ¬∑ ${studentCount} students ¬∑ ${subjectCount} subjects
              </div>
            </div>
            <div class="btn-group">
              <button class="btn btn-danger btn-small" onclick="removeClass('${cls.id}')">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderClassDropdowns() {
      const subjectClassSelect = document.getElementById('subjectClass');
      const studentClassSelect = document.getElementById('studentClass');
      
      const options = '<option value="">Select Class</option>' + 
        state.classes.map(cls => 
          `<option value="${cls.id}">${escapeHtml(cls.name)} (${escapeHtml(cls.year)} - Sec ${escapeHtml(cls.section)})</option>`
        ).join('');
      
      subjectClassSelect.innerHTML = options;
      studentClassSelect.innerHTML = options;
    }

    function renderSubjectList() {
      const container = document.getElementById('subjectList');
      
      if (state.subjects.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding:30px">
            <div class="empty-state-icon">üìö</div>
            <p style="font-size:14px">No subjects added yet</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = state.subjects.map(sub => {
        const cls = state.classes.find(c => c.id === sub.classId);
        return `
          <div class="item-card">
            <div class="item-info">
              <div class="item-name">${escapeHtml(sub.name)}</div>
              <div class="item-detail">
                <span class="badge subject-badge">${escapeHtml(sub.code)}</span>
                ${cls ? `<span class="badge class-badge">${escapeHtml(cls.name)}</span>` : ''}
              </div>
            </div>
            <div class="btn-group">
              <button class="btn btn-danger btn-small" onclick="removeSubject('${sub.id}')">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderStudentList() {
      const container = document.getElementById('studentList');
      const search = document.getElementById('searchStudent').value.toLowerCase();
      
      if (state.students.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üë•</div>
            <p>No students added yet</p>
          </div>
        `;
        return;
      }
      
      const filtered = state.students.filter(s => 
        s.name.toLowerCase().includes(search) || 
        s.roll.toLowerCase().includes(search)
      );
      
      container.innerHTML = filtered.map(s => {
        const cls = state.classes.find(c => c.id === s.classId);
        return `
          <div class="item-card">
            <div class="item-info">
              <div class="item-name">${escapeHtml(s.name)}</div>
              <div class="item-detail">
                Roll: ${escapeHtml(s.roll)}
                ${cls ? `<span class="badge class-badge">${escapeHtml(cls.name)}</span>
                        <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>` : ''}
              </div>
            </div>
            <div class="btn-group">
              <button class="btn btn-danger btn-small" onclick="removeStudent('${s.id}')">
                üóëÔ∏è
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderClassSelector() {
      const container = document.getElementById('classSelector');
      
      if (state.classes.length === 0) {
        container.innerHTML = `
          <div style="width:100%;text-align:center;color:var(--text-muted);font-weight:600">
            Add classes to filter by class
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="chip ${!state.selectedClass ? 'active' : ''}" onclick="selectClass(null)">
          üéì All Classes
        </div>
        ${state.classes.map(cls => `
          <div class="chip ${state.selectedClass === cls.id ? 'active' : ''}" 
               onclick="selectClass('${cls.id}')">
            üè´ ${escapeHtml(cls.name)} (Sec ${escapeHtml(cls.section)})
          </div>
        `).join('')}
      `;
    }

    function renderSubjectSelector() {
      const container = document.getElementById('subjectSelector');
      
      const classId = state.selectedClass;
      let subjects = state.subjects;
      
      if (classId) {
        subjects = subjects.filter(s => s.classId === classId);
      }
      
      if (subjects.length === 0) {
        container.innerHTML = `
          <div style="width:100%;text-align:center;color:var(--text-muted);font-weight:600">
            ${classId ? 'No subjects for selected class' : 'Add subjects to filter by subject'}
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="chip ${!state.selectedSubject ? 'active' : ''}" onclick="selectSubject(null)">
          üìä All Subjects
        </div>
        ${subjects.map(sub => `
          <div class="chip ${state.selectedSubject === sub.id ? 'active' : ''}" 
               onclick="selectSubject('${sub.id}')">
            üìò ${escapeHtml(sub.code)}
          </div>
        `).join('')}
      `;
    }

    function renderAttendanceTable() {
      const tbody = document.getElementById('attendanceTable');
      const date = document.getElementById('dateSelect').value;
      const classId = state.selectedClass;
      const subjectId = state.selectedSubject;
      
      let filteredStudents = state.students;
      if (classId) {
        filteredStudents = filteredStudents.filter(s => s.classId === classId);
      }
      
      if (filteredStudents.length === 0) {
        tbody.innerHTML = `
          <tr><td colspan="6" style="text-align:center;padding:60px;color:var(--text-muted)">
            <div class="empty-state-icon" style="font-size:64px;margin-bottom:16px">üë•</div>
            No students to track
          </td></tr>
        `;
        return;
      }
      
      if (!subjectId) {
        tbody.innerHTML = `
          <tr><td colspan="6" style="text-align:center;padding:60px;color:var(--text-muted)">
            <div class="empty-state-icon" style="font-size:64px;margin-bottom:16px">üìö</div>
            Please select a subject to mark attendance
          </td></tr>
        `;
        return;
      }
      
      const subject = state.subjects.find(s => s.id === subjectId);
      
      tbody.innerHTML = filteredStudents.map(s => {
        const status = getAttendance(date, s.id, subjectId);
        const isPresent = status === 'present';
        const cls = state.classes.find(c => c.id === s.classId);
        
        return `
          <tr>
            <td data-label="Roll No"><strong>${escapeHtml(s.roll)}</strong></td>
            <td data-label="Name">${escapeHtml(s.name)}</td>
            <td data-label="Class">
              ${cls ? `<span class="badge class-badge">${escapeHtml(cls.name)}</span>
                      <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>` : '-'}
            </td>
            <td data-label="Subject">
              ${subject ? `<span class="badge subject-badge">${escapeHtml(subject.code)}</span>` : '-'}
            </td>
            <td data-label="Status">
              <span class="badge ${isPresent ? 'status-present' : 'status-absent'}">
                ${isPresent ? '‚úì Present' : '‚úó Absent'}
              </span>
            </td>
            <td data-label="Action">
              <button class="btn ${isPresent ? 'btn-danger' : 'btn-success'} btn-small" 
                      onclick="toggleAttendance('${date}', '${s.id}', '${subjectId}')">
                ${isPresent ? '‚úó' : '‚úì'}
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function renderClassWiseView() {
      const container = document.getElementById('classWiseContent');
      const date = document.getElementById('dateSelect').value;
      
      if (state.classes.length === 0 || state.students.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üè´</div>
            <p>Add classes and students to view class-wise attendance</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="scroll-container">
          ${state.classes.map(cls => {
            const classStudents = state.students.filter(s => s.classId === cls.id);
            const classSubjects = state.subjects.filter(s => s.classId === cls.id);
            
            if (classStudents.length === 0) {
              return `
                <div style="margin-bottom:24px;padding:24px;background:rgba(15, 23, 42, 0.8);border-radius:16px;border:1px solid var(--border)">
                  <h3 style="font-size:20px;font-weight:700;margin-bottom:8px">
                    üè´ ${escapeHtml(cls.name)} 
                    <span class="badge class-badge">${escapeHtml(cls.year)}</span>
                    <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>
                  </h3>
                  <p style="color:var(--text-muted)">No students in this class</p>
                </div>
              `;
            }
            
            let totalPresent = 0;
            let totalClasses = 0;
            
            classStudents.forEach(student => {
              classSubjects.forEach(subject => {
                if (getAttendance(date, student.id, subject.id) === 'present') {
                  totalPresent++;
                }
                totalClasses++;
              });
            });
            
            const rate = totalClasses > 0 ? Math.round((totalPresent / totalClasses) * 100) : 0;
            
            return `
              <div style="margin-bottom:24px;padding:24px;background:rgba(15, 23, 42, 0.8);border-radius:16px;border:1px solid var(--border)">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:16px">
                  <div>
                    <h3 style="font-size:20px;font-weight:700;margin-bottom:8px">
                      üè´ ${escapeHtml(cls.name)}
                      <span class="badge class-badge">${escapeHtml(cls.year)}</span>
                      <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>
                    </h3>
                    <p style="font-size:14px;color:var(--text-muted)">
                      ${classStudents.length} students ¬∑ ${classSubjects.length} subjects
                    </p>
                  </div>
                  <div style="text-align:right">
                    <div style="font-size:42px;font-weight:900;background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent">
                      ${rate}%
                    </div>
                    <div style="font-size:12px;color:var(--text-muted);font-weight:600">
                      Overall Attendance
                    </div>
                  </div>
                </div>
                
                ${classSubjects.length > 0 ? `
                  <div style="margin-bottom:20px">
                    <h4 style="font-size:14px;font-weight:700;margin-bottom:12px;color:var(--text)">Subject-wise breakdown:</h4>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px">
                      ${classSubjects.map(subject => {
                        const present = classStudents.filter(s => 
                          getAttendance(date, s.id, subject.id) === 'present'
                        ).length;
                        const total = classStudents.length;
                        const subRate = total > 0 ? Math.round((present / total) * 100) : 0;
                        
                        return `
                          <div style="padding:16px;background:rgba(30, 41, 59, 0.8);border-radius:12px;border:1px solid var(--border)">
                            <div style="font-weight:700;font-size:13px;margin-bottom:6px">
                              üìò ${escapeHtml(subject.code)}
                            </div>
                            <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px">
                              ${escapeHtml(subject.name)}
                            </div>
                            <div style="font-size:28px;font-weight:800;color:${subRate >= 75 ? 'var(--success)' : 'var(--danger)'}">
                              ${subRate}%
                            </div>
                            <div style="font-size:11px;color:var(--text-muted);font-weight:600">
                              ${present}/${total} present
                            </div>
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                ` : ''}
                
                <table style="font-size:13px">
                  <thead>
                    <tr>
                      <th style="padding:12px">Roll</th>
                      <th style="padding:12px">Name</th>
                      ${classSubjects.map(sub => `
                        <th style="padding:12px;text-align:center">${escapeHtml(sub.code)}</th>
                      `).join('')}
                      <th style="padding:12px;text-align:center">Rate</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${classStudents.map(s => {
                      let presentCount = 0;
                      const subjectCells = classSubjects.map(subject => {
                        const status = getAttendance(date, s.id, subject.id);
                        if (status === 'present') presentCount++;
                        return `
                          <td style="padding:12px;text-align:center">
                            <span class="badge ${status === 'present' ? 'status-present' : 'status-absent'}" style="padding:4px 10px;font-size:11px">
                              ${status === 'present' ? '‚úì' : '‚úó'}
                            </span>
                          </td>
                        `;
                      }).join('');
                      
                      const studentRate = classSubjects.length > 0 ? Math.round((presentCount / classSubjects.length) * 100) : 0;
                      
                      return `
                        <tr>
                          <td style="padding:12px"><strong>${escapeHtml(s.roll)}</strong></td>
                          <td style="padding:12px">${escapeHtml(s.name)}</td>
                          ${subjectCells}
                          <td style="padding:12px;text-align:center">
                            <span class="badge ${studentRate >= 75 ? 'status-present' : 'status-absent'}">
                              ${studentRate}%
                            </span>
                          </td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function renderSubjectWiseView() {
      const container = document.getElementById('subjectWiseContent');
      const date = document.getElementById('dateSelect').value;
      
      if (state.subjects.length === 0 || state.students.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìö</div>
            <p>Add subjects and students to view subject-wise attendance</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="scroll-container">
          ${state.subjects.map(subject => {
            const cls = state.classes.find(c => c.id === subject.classId);
            const classStudents = state.students.filter(s => s.classId === subject.classId);
            
            const present = classStudents.filter(s => 
              getAttendance(date, s.id, subject.id) === 'present'
            ).length;
            const total = classStudents.length;
            const rate = total > 0 ? Math.round((present / total) * 100) : 0;
            
            return `
              <div style="margin-bottom:24px;padding:24px;background:rgba(15, 23, 42, 0.8);border-radius:16px;border:1px solid var(--border)">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:16px">
                  <div>
                    <h3 style="font-size:20px;font-weight:700;margin-bottom:8px">
                      üìò ${escapeHtml(subject.name)}
                      <span class="badge subject-badge">${escapeHtml(subject.code)}</span>
                    </h3>
                    <p style="font-size:14px;color:var(--text-muted)">
                      ${cls ? `Class: ${escapeHtml(cls.name)} (${escapeHtml(cls.year)} - Sec ${escapeHtml(cls.section)})` : 'No class assigned'}
                    </p>
                  </div>
                  <div style="text-align:right">
                    <div style="font-size:42px;font-weight:900;background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent">
                      ${rate}%
                    </div>
                    <div style="font-size:12px;color:var(--text-muted);font-weight:600">
                      ${present}/${total} Present
                    </div>
                  </div>
                </div>
                
                <table style="font-size:13px">
                  <thead>
                    <tr>
                      <th style="padding:12px">Roll</th>
                      <th style="padding:12px">Name</th>
                      <th style="padding:12px">Status</th>
                      <th style="padding:12px">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${classStudents.map(s => {
                      const status = getAttendance(date, s.id, subject.id);
                      const isPresent = status === 'present';
                      return `
                        <tr>
                          <td style="padding:12px"><strong>${escapeHtml(s.roll)}</strong></td>
                          <td style="padding:12px">${escapeHtml(s.name)}</td>
                          <td style="padding:12px">
                            <span class="badge ${isPresent ? 'status-present' : 'status-absent'}">
                              ${isPresent ? '‚úì Present' : '‚úó Absent'}
                            </span>
                          </td>
                          <td style="padding:12px">
                            <button class="btn ${isPresent ? 'btn-danger' : 'btn-success'} btn-small" 
                                    onclick="toggleAttendance('${date}', '${s.id}', '${subject.id}')">
                              ${isPresent ? '‚úó' : '‚úì'}
                            </button>
                          </td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function renderHistory() {
      const container = document.getElementById('historyList');
      const dates = Object.keys(state.attendance).sort().reverse();
      
      if (dates.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <p>No attendance records yet</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = dates.map(date => {
        const dateData = state.attendance[date];
        
        const classStats = {};
        state.classes.forEach(cls => {
          const classStudents = state.students.filter(s => s.classId === cls.id);
          const classSubjects = state.subjects.filter(s => s.classId === cls.id);
          let present = 0;
          let total = 0;
          classStudents.forEach(student => {
            classSubjects.forEach(subject => {
              if (dateData[student.id]?.[subject.id] === 'present') present++;
              total++;
            });
          });
          classStats[cls.id] = {
            name: cls.name,
            year: cls.year,
            section: cls.section,
            present,
            total,
            rate: total > 0 ? Math.round((present / total) * 100) : 0
          };
        });
        
        return `
          <div style="margin-bottom:16px;padding:20px;background:rgba(15, 23, 42, 0.8);border-radius:12px;border-left:4px solid var(--accent-1)">
            <div style="font-weight:700;font-size:18px;margin-bottom:12px">üìÖ ${formatDate(date)}</div>
            
            ${state.classes.length > 0 ? `
              <div style="margin:12px 0">
                <strong style="font-size:12px;color:var(--text-muted);text-transform:uppercase">Classes:</strong>
                <div style="margin-top:8px">
                  ${Object.values(classStats).map(stat => `
                    <div style="display:inline-block;margin:4px 8px 4px 0;padding:8px 16px;background:rgba(30, 41, 59, 0.8);border-radius:8px;font-size:13px;font-weight:600">
                      üè´ ${escapeHtml(stat.name)} (Sec ${escapeHtml(stat.section)}): 
                      <span style="color:${stat.rate >= 75 ? 'var(--success)' : 'var(--danger)'}">${stat.rate}%</span>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
            
            <div style="margin-top:16px">
              <button class="btn btn-outline btn-small" onclick="viewDate('${date}')">üëÅÔ∏è View</button>
              <button class="btn btn-secondary btn-small" onclick="deleteDate('${date}')">üóëÔ∏è Delete</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderReports() {
      const container = document.getElementById('reportContent');
      
      if (state.students.length === 0 || state.subjects.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <p>Add students and subjects to view reports</p>
          </div>
        `;
        return;
      }
      
      const dates = Object.keys(state.attendance);
      
      const studentReports = state.students.map(s => {
        const cls = state.classes.find(c => c.id === s.classId);
        const classSubjects = state.subjects.filter(sub => sub.classId === s.classId);
        const subjectStats = {};
        let totalPresent = 0;
        let totalClasses = 0;
        
        classSubjects.forEach(subject => {
          let present = 0;
          dates.forEach(date => {
            if (getAttendance(date, s.id, subject.id) === 'present') present++;
          });
          subjectStats[subject.id] = {
            present,
            total: dates.length,
            rate: dates.length > 0 ? Math.round((present / dates.length) * 100) : 0
          };
          totalPresent += present;
          totalClasses += dates.length;
        });
        
        const overallRate = totalClasses > 0 ? Math.round((totalPresent / totalClasses) * 100) : 0;
        
        return {
          ...s,
          class: cls,
          subjectStats,
          overallRate,
          totalPresent,
          totalClasses
        };
      }).sort((a, b) => b.overallRate - a.overallRate);
      
      container.innerHTML = `
        <div class="scroll-container">
          <div style="margin-bottom:32px">
            <h3 style="font-size:22px;font-weight:700;margin-bottom:20px">
              üèÜ Overall Student Performance
            </h3>
            <table>
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Roll</th>
                  <th>Name</th>
                  <th>Class</th>
                  <th>Present/Total</th>
                  <th>Overall %</th>
                </tr>
              </thead>
              <tbody>
                ${studentReports.map((s, i) => `
                  <tr>
                    <td data-label="Rank"><strong>#${i + 1}</strong></td>
                    <td data-label="Roll">${escapeHtml(s.roll)}</td>
                    <td data-label="Name">${escapeHtml(s.name)}</td>
                    <td data-label="Class">
                      ${s.class ? `<span class="badge class-badge">${escapeHtml(s.class.name)}</span>
                                  <span class="badge section-badge">Sec ${escapeHtml(s.class.section)}</span>` : '-'}
                    </td>
                    <td data-label="Present/Total">${s.totalPresent}/${s.totalClasses}</td>
                    <td data-label="Overall %">
                      <span class="badge ${s.overallRate >= 75 ? 'status-present' : 'status-absent'}">
                        ${s.overallRate}%
                      </span>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
          
          ${state.classes.length > 0 ? `
            <div style="margin-bottom:32px">
              <h3 style="font-size:22px;font-weight:700;margin-bottom:20px">
                üè´ Class-Wise Performance
              </h3>
              <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px">
                ${state.classes.map(cls => {
                  const classStudents = state.students.filter(s => s.classId === cls.id);
                  const classSubjects = state.subjects.filter(s => s.classId === cls.id);
                  let totalPresent = 0;
                  let totalClasses = 0;
                  
                  classStudents.forEach(student => {
                    dates.forEach(date => {
                      classSubjects.forEach(subject => {
                        if (getAttendance(date, student.id, subject.id) === 'present') {
                          totalPresent++;
                        }
                        totalClasses++;
                      });
                    });
                  });
                  
                  const rate = totalClasses > 0 ? Math.round((totalPresent / totalClasses) * 100) : 0;
                  
                  return `
                    <div style="padding:24px;background:rgba(15, 23, 42, 0.8);border-radius:16px;border:1px solid var(--border)">
                      <div style="font-weight:700;font-size:18px;margin-bottom:12px">
                        üè´ ${escapeHtml(cls.name)}
                      </div>
                      <div style="margin-bottom:12px">
                        <span class="badge class-badge">${escapeHtml(cls.year)}</span>
                        <span class="badge section-badge">Sec ${escapeHtml(cls.section)}</span>
                      </div>
                      <div style="font-size:48px;font-weight:900;margin-bottom:8px;background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent">
                        ${rate}%
                      </div>
                      <div style="font-size:13px;color:var(--text-muted);font-weight:600;margin-bottom:4px">
                        ${classStudents.length} students ¬∑ ${classSubjects.length} subjects
                      </div>
                      <div style="font-size:12px;color:var(--text-muted);font-weight:600">
                        ${totalPresent}/${totalClasses} total attendance
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}
          
          <div>
            <h3 style="font-size:22px;font-weight:700;margin-bottom:20px">
              üìö Detailed Student Reports
            </h3>
            ${studentReports.map(student => {
              const classSubjects = state.subjects.filter(s => s.classId === student.classId);
              return `
                <div style="margin-bottom:24px;padding:24px;background:rgba(15, 23, 42, 0.8);border-radius:16px;border:1px solid var(--border)">
                  <div style="font-weight:700;font-size:18px;margin-bottom:12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px">
                    <div>
                      ${escapeHtml(student.name)} (${escapeHtml(student.roll)})
                      ${student.class ? `<span class="badge class-badge">${escapeHtml(student.class.name)}</span>
                                        <span class="badge section-badge">Sec ${escapeHtml(student.class.section)}</span>` : ''}
                    </div>
                    <span style="color:var(--accent-1);font-size:20px">Overall: ${student.overallRate}%</span>
                  </div>
                  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px">
                    ${classSubjects.map(subject => {
                      const stats = student.subjectStats[subject.id];
                      return `
                        <div style="padding:16px;background:rgba(30, 41, 59, 0.8);border-radius:12px;border:1px solid var(--border)">
                          <div style="font-weight:700;font-size:14px;margin-bottom:6px">
                            üìò ${escapeHtml(subject.code)}
                          </div>
                          <div style="font-size:12px;color:var(--text-muted);margin-bottom:10px">
                            ${escapeHtml(subject.name)}
                          </div>
                          <div style="font-size:32px;font-weight:800;color:${stats.rate >= 75 ? 'var(--success)' : 'var(--danger)'}">
                            ${stats.rate}%
                          </div>
                          <div style="font-size:11px;color:var(--text-muted);font-weight:600">
                            ${stats.present}/${stats.total} classes
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function getAttendance(date, studentId, subjectId) {
      return state.attendance[date]?.[studentId]?.[subjectId] || 'absent';
    }

    function getOverallAttendance(date, studentId) {
      const student = state.students.find(s => s.id === studentId);
      if (!student) return 'absent';
      
      const classSubjects = state.subjects.filter(s => s.classId === student.classId);
      if (classSubjects.length === 0) return 'absent';
      
      const presentCount = classSubjects.filter(sub => 
        getAttendance(date, studentId, sub.id) === 'present'
      ).length;
      return presentCount > classSubjects.length / 2 ? 'present' : 'absent';
    }

    function setAttendance(date, studentId, subjectId, status) {
      if (!state.attendance[date]) state.attendance[date] = {};
      if (!state.attendance[date][studentId]) state.attendance[date][studentId] = {};
      state.attendance[date][studentId][subjectId] = status;
    }

    function toggleAttendance(date, studentId, subjectId) {
      const current = getAttendance(date, studentId, subjectId);
      setAttendance(date, studentId, subjectId, current === 'present' ? 'absent' : 'present');
      saveState();
      render();
    }

    function selectClass(classId) {
      state.selectedClass = classId;
      state.selectedSubject = null;
      render();
    }

    function selectSubject(subjectId) {
      state.selectedSubject = subjectId;
      render();
    }

    function removeClass(id) {
      if (!confirm('Remove this class? All related subjects and attendance will be deleted.')) return;
      
      const subjectsToDelete = state.subjects.filter(s => s.classId === id);
      state.subjects = state.subjects.filter(s => s.classId !== id);
      
      state.students.forEach(student => {
        if (student.classId === id) {
          student.classId = null;
        }
      });
      
      Object.keys(state.attendance).forEach(date => {
        Object.keys(state.attendance[date]).forEach(studentId => {
          subjectsToDelete.forEach(subject => {
            delete state.attendance[date][studentId][subject.id];
          });
        });
      });
      
      state.classes = state.classes.filter(c => c.id !== id);
      if (state.selectedClass === id) state.selectedClass = null;
      
      saveState();
      render();
    }

    function removeSubject(id) {
      if (!confirm('Remove this subject? All attendance records will be deleted.')) return;
      
      state.subjects = state.subjects.filter(s => s.id !== id);
      
      Object.keys(state.attendance).forEach(date => {
        Object.keys(state.attendance[date]).forEach(studentId => {
          delete state.attendance[date][studentId][id];
        });
      });
      
      if (state.selectedSubject === id) state.selectedSubject = null;
      
      saveState();
      render();
    }

    function removeStudent(id) {
      if (!confirm('Remove this student? All attendance records will be deleted.')) return;
      
      state.students = state.students.filter(s => s.id !== id);
      
      Object.keys(state.attendance).forEach(date => {
        delete state.attendance[date][id];
      });
      
      saveState();
      render();
    }

    function viewDate(date) {
      document.getElementById('dateSelect').value = date;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector('[data-view="today"]').classList.add('active');
      switchView('today');
      render();
    }

    function deleteDate(date) {
      if (!confirm(`Delete attendance records for ${formatDate(date)}?`)) return;
      delete state.attendance[date];
      saveState();
      render();
    }

    function switchView(view) {
      document.getElementById('todayView').style.display = view === 'today' ? 'block' : 'none';
      document.getElementById('classWiseView').style.display = view === 'class-wise' ? 'block' : 'none';
      document.getElementById('subjectWiseView').style.display = view === 'subject-wise' ? 'block' : 'none';
      document.getElementById('historyView').style.display = view === 'history' ? 'block' : 'none';
      document.getElementById('reportsView').style.display = view === 'reports' ? 'block' : 'none';
    }

    function attachEventListeners() {
      document.getElementById('addClassBtn').addEventListener('click', () => {
        const name = document.getElementById('className').value.trim();
        const year = document.getElementById('classYear').value;
        const section = document.getElementById('classSection').value.trim();
        
        if (!name || !year || !section) {
          alert('Please fill all class details');
          return;
        }
        
        const id = 'cls_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        state.classes.push({ id, name, year, section });
        
        document.getElementById('className').value = '';
        document.getElementById('classYear').value = '';
        document.getElementById('classSection').value = '';
        
        saveState();
        render();
      });

      document.getElementById('addSubjectBtn').addEventListener('click', () => {
        const classId = document.getElementById('subjectClass').value;
        const name = document.getElementById('subjectName').value.trim();
        const code = document.getElementById('subjectCode').value.trim();
        
        if (!classId || !name || !code) {
          alert('Please fill all subject details');
          return;
        }
        
        const id = 'sub_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        state.subjects.push({ id, classId, name, code });
        
        document.getElementById('subjectClass').value = '';
        document.getElementById('subjectName').value = '';
        document.getElementById('subjectCode').value = '';
        
        saveState();
        render();
      });

      document.getElementById('addStudentBtn').addEventListener('click', () => {
        const name = document.getElementById('studentName').value.trim();
        const roll = document.getElementById('studentRoll').value.trim();
        const classId = document.getElementById('studentClass').value;
        
        if (!name || !roll || !classId) {
          alert('Please fill all student details');
          return;
        }
        
        const id = 's_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        state.students.push({ id, name, roll, classId });
        
        document.getElementById('studentName').value = '';
        document.getElementById('studentRoll').value = '';
        document.getElementById('studentClass').value = '';
        
        saveState();
        render();
      });

      document.getElementById('dateSelect').addEventListener('change', render);
      document.getElementById('searchStudent').addEventListener('input', renderStudentList);

      document.getElementById('quickAction').addEventListener('change', (e) => {
        const action = e.target.value;
        if (!action) return;
        
        if (!state.selectedSubject) {
          alert('Please select a subject first');
          e.target.value = '';
          return;
        }
        
        const date = document.getElementById('dateSelect').value;
        const status = action === 'all-present' ? 'present' : 'absent';
        const classId = state.selectedClass;
        
        let studentsToMark = state.students;
        if (classId) {
          studentsToMark = studentsToMark.filter(s => s.classId === classId);
        }
        
        studentsToMark.forEach(s => {
          setAttendance(date, s.id, state.selectedSubject, status);
        });
        
        saveState();
        render();
        e.target.value = '';
      });

      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          switchView(tab.dataset.view);
          render();
        });
      });

      document.getElementById('exportCsvBtn').addEventListener('click', () => {
        const date = document.getElementById('dateSelect').value;
        exportTodayCSV(date);
      });

      document.getElementById('exportClassCsvBtn').addEventListener('click', () => {
        const date = document.getElementById('dateSelect').value;
        if (!state.selectedClass) {
          alert('Please select a class first to export class-wise attendance');
          return;
        }
        exportClassWiseCSV(date);
      });

      document.getElementById('exportSubjectCsvBtn').addEventListener('click', () => {
        const date = document.getElementById('dateSelect').value;
        if (!state.selectedSubject) {
          alert('Please select a subject first to export subject-wise attendance');
          return;
        }
        exportSubjectWiseCSV(date);
      });

      document.getElementById('exportAllBtn').addEventListener('click', exportAllRecords);

      document.getElementById('loadSampleBtn').addEventListener('click', () => {
        if ((state.students.length > 0 || state.subjects.length > 0 || state.classes.length > 0) && 
            !confirm('This will replace existing data. Continue?')) return;
        
        state.classes = [
          { id: 'cls1', name: 'BE Computer', year: 'BE', section: 'A' },
          { id: 'cls2', name: 'BE Computer', year: 'BE', section: 'B' },
          { id: 'cls3', name: 'BE IT', year: 'BE', section: 'A' },
          { id: 'cls4', name: 'TE Computer', year: 'TE', section: 'A' }
        ];
        
        state.subjects = [
          { id: 'sub1', classId: 'cls1', name: 'Data Structures', code: 'CS301' },
          { id: 'sub2', classId: 'cls1', name: 'Operating Systems', code: 'CS302' },
          { id: 'sub3', classId: 'cls1', name: 'Database Management', code: 'CS303' },
          { id: 'sub4', classId: 'cls2', name: 'Data Structures', code: 'CS301' },
          { id: 'sub5', classId: 'cls2', name: 'Computer Networks', code: 'CS304' },
          { id: 'sub6', classId: 'cls3', name: 'Web Technologies', code: 'IT301' },
          { id: 'sub7', classId: 'cls3', name: 'Software Engineering', code: 'IT302' },
          { id: 'sub8', classId: 'cls4', name: 'Algorithms', code: 'CS201' }
        ];
        
        state.students = [
          { id: 's1', name: 'Rahul Sharma', roll: 'NIT2021001', classId: 'cls1' },
          { id: 's2', name: 'Priya Deshmukh', roll: 'NIT2021002', classId: 'cls1' },
          { id: 's3', name: 'Aman Verma', roll: 'NIT2021003', classId: 'cls1' },
          { id: 's4', name: 'Sneha Patel', roll: 'NIT2021004', classId: 'cls2' },
          { id: 's5', name: 'Vikram Kumar', roll: 'NIT2021005', classId: 'cls2' },
          { id: 's6', name: 'Neha Gupta', roll: 'NIT2021006', classId: 'cls3' },
          { id: 's7', name: 'Arjun Reddy', roll: 'NIT2022001', classId: 'cls4' },
          { id: 's8', name: 'Kavya Menon', roll: 'NIT2022002', classId: 'cls4' }
        ];
        
        const today = new Date().toISOString().split('T')[0];
        state.attendance[today] = {};
        
        state.students.forEach((student, i) => {
          state.attendance[today][student.id] = {};
          const classSubjects = state.subjects.filter(s => s.classId === student.classId);
          classSubjects.forEach((subject, j) => {
            state.attendance[today][student.id][subject.id] = 
              (i + j) % 3 === 0 ? 'absent' : 'present';
          });
        });
        
        saveState();
        render();
      });

      document.getElementById('clearAllBtn').addEventListener('click', () => {
        if (!confirm('Delete all data? This cannot be undone!')) return;
        state = { 
          classes: [],
          subjects: [],
          students: [],
          attendance: {},
          selectedClass: null,
          selectedSubject: null,
          savedAt: null
        };
        saveState();
        render();
      });
    }

    function exportTodayCSV(date) {
      if (!state.selectedSubject) {
        alert('Please select a subject to export');
        return;
      }
      
      const subject = state.subjects.find(s => s.id === state.selectedSubject);
      const classStudents = state.students.filter(s => s.classId === subject.classId);
      const cls = state.classes.find(c => c.id === subject.classId);
      
      const rows = [['Date', 'Subject', 'Subject Code', 'Class', 'Roll No', 'Name', 'Status']];
      
      classStudents.forEach(student => {
        const status = getAttendance(date, student.id, state.selectedSubject);
        rows.push([
          date,
          subject.name,
          subject.code,
          cls ? `${cls.name} (${cls.year} - Sec ${cls.section})` : '-',
          student.roll,
          student.name,
          status === 'present' ? 'Present' : 'Absent'
        ]);
      });
      
      downloadCSV(rows, `attendance-${subject.code}-${date}.csv`);
    }

    function exportClassWiseCSV(date) {
      // Export only the selected class
      const classId = state.selectedClass;
      if (!classId) {
        alert('Please select a class first to export class-wise attendance');
        return;
      }
      
      const cls = state.classes.find(c => c.id === classId);
      const classStudents = state.students.filter(s => s.classId === cls.id);
      const classSubjects = state.subjects.filter(s => s.classId === cls.id);
      
      if (classSubjects.length === 0) {
        alert('No subjects found for this class');
        return;
      }
      
      const rows = [['Roll No', 'Name', ...classSubjects.map(s => s.code), 'Attendance Rate']];
      
      classStudents.forEach(student => {
        const row = [student.roll, student.name];
        let presentCount = 0;
        
        classSubjects.forEach(subject => {
          const status = getAttendance(date, student.id, subject.id);
          row.push(status === 'present' ? 'Present' : 'Absent');
          if (status === 'present') presentCount++;
        });
        
        const rate = classSubjects.length > 0 ? Math.round((presentCount / classSubjects.length) * 100) : 0;
        row.push(rate + '%');
        rows.push(row);
      });
      
      downloadCSV(rows, `${cls.name.replace(/\s+/g, '-')}-${cls.year}-Sec${cls.section}-attendance-${date}.csv`);
    }

    function exportSubjectWiseCSV(date) {
      // Export only the selected subject
      const subjectId = state.selectedSubject;
      if (!subjectId) {
        alert('Please select a subject first');
        return;
      }
      
      const subject = state.subjects.find(s => s.id === subjectId);
      const cls = state.classes.find(c => c.id === subject.classId);
      const classStudents = state.students.filter(s => s.classId === subject.classId);
      
      const rows = [['Roll No', 'Name', 'Class', 'Year', 'Section', 'Status', 'Date', 'Subject', 'Subject Code']];
      
      classStudents.forEach(student => {
        const status = getAttendance(date, student.id, subject.id);
        rows.push([
          student.roll,
          student.name,
          cls ? cls.name : '-',
          cls ? cls.year : '-',
          cls ? cls.section : '-',
          status === 'present' ? 'Present' : 'Absent',
          date,
          subject.name,
          subject.code
        ]);
      });
      
      downloadCSV(rows, `${subject.code}-${cls ? cls.name.replace(/\s+/g, '-') : 'class'}-Sec${cls ? cls.section : ''}-attendance-${date}.csv`);
    }

    function exportAllRecords() {
      const rows = [['Date', 'Roll No', 'Name', 'Class', 'Year', 'Section', 'Subject Code', 'Subject Name', 'Status']];
      const dates = Object.keys(state.attendance).sort();
      
      dates.forEach(date => {
        state.students.forEach(student => {
          const cls = state.classes.find(c => c.id === student.classId);
          const classSubjects = state.subjects.filter(s => s.classId === student.classId);
          
          classSubjects.forEach(subject => {
            const status = getAttendance(date, student.id, subject.id);
            rows.push([
              date,
              student.roll,
              student.name,
              cls ? cls.name : '-',
              cls ? cls.year : '-',
              cls ? cls.section : '-',
              subject.code,
              subject.name,
              status === 'present' ? 'Present' : 'Absent'
            ]);
          });
        });
      });
      
      downloadCSV(rows, `nit-all-attendance-records.csv`);
    }

    function downloadCSV(rows, filename) {
      const csv = rows.map(r => r.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-IN', { 
        weekday: 'short', 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>